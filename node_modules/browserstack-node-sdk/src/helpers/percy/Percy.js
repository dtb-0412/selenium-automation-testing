const a109_0x38f5aa=a109_0x19af;function a109_0x19af(_0x1b6f08,_0x3984ee){const _0x518ce6=a109_0x518c();return a109_0x19af=function(_0x19afaf,_0x2c1433){_0x19afaf=_0x19afaf-0xdb;let _0x4b9745=_0x518ce6[_0x19afaf];return _0x4b9745;},a109_0x19af(_0x1b6f08,_0x3984ee);}(function(_0x20916b,_0x4a5684){const _0x475623=a109_0x19af,_0xa13433=_0x20916b();while(!![]){try{const _0x31f857=-parseInt(_0x475623(0xe6))/0x1+-parseInt(_0x475623(0xf7))/0x2+-parseInt(_0x475623(0xe5))/0x3*(parseInt(_0x475623(0xe2))/0x4)+-parseInt(_0x475623(0x101))/0x5*(parseInt(_0x475623(0xf1))/0x6)+parseInt(_0x475623(0xde))/0x7+-parseInt(_0x475623(0x11b))/0x8+-parseInt(_0x475623(0x126))/0x9*(-parseInt(_0x475623(0xef))/0xa);if(_0x31f857===_0x4a5684)break;else _0xa13433['push'](_0xa13433['shift']());}catch(_0x352dee){_0xa13433['push'](_0xa13433['shift']());}}}(a109_0x518c,0xcdbda));const fs=require('fs'),path=require(a109_0x38f5aa(0x119)),os=require('os'),{spawn}=require(a109_0x38f5aa(0x116)),helper=require('../helper'),logger=require(a109_0x38f5aa(0xf0))['winstonLogger'],{getLogDir}=require(a109_0x38f5aa(0xf0)),testHubConstants=require(a109_0x38f5aa(0x100)),PerformanceTester=require(a109_0x38f5aa(0xe8)),{PERCY_EVENTS:PerformanceEvents}=require(a109_0x38f5aa(0xed)),PercyBinary=require(a109_0x38f5aa(0xe1));function a109_0x518c(){const _0x4192af=['&type=','join','isRunning','projectName','createPercyConfig','../../helpers/testhub/constants','1929725noSZuv','flags','debug','PERCY_SERVER_ADDRESS','stderr','percy.json','tmpdir','dNdtD','start','stdout','percy/healthcheck','Error\x20creating\x20percy\x20config:\x20','http://localhost:5338','close','token','knfob','UwvTA','Percy\x20healthcheck\x20successful','fRsjp','nodeRequest','WFwDZ','child_process','ENV_VAR','app','path','percyOptions','8930424GGZbzp','GET','tnPcb','FhXTS','stop','assign','DOWNLOAD','JLjZk','api/app_percy/get_project_token?name=','SsoCu','healthcheck','880362XCONKq',':start','end','AhrxW','exec','env','ZaVwR','VTpEk','ntcCG','createWriteStream','9203530xupamR','CWVkj','DCRET','./PercyBinary','332aYtMme','Percy\x20fetch\x20token\x20success','NPAlK','57837QopcSY','1343051Vtiyfx','IbfnN','../../helpers/performance/performance-tester','jgSAO','push','writeFile','isProcessRunning','../../helpers/performance/constants','getBinaryPath','490IBITnt','../logger','12cXLtUK','exports','fetchPercyToken','automate','version','app:exec','867514IUofyE','PsEqC','percy.log','pipe'];a109_0x518c=function(){return _0x4192af;};return a109_0x518c();}class Percy{#logfile=path[a109_0x38f5aa(0xfc)](getLogDir(),a109_0x38f5aa(0xf9));#address=process['env'][a109_0x38f5aa(0x104)]||a109_0x38f5aa(0x10d);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];['isProcessRunning']=![];constructor(_0x40d90a){const _0x1384e1=a109_0x38f5aa;this.#config=_0x40d90a,!!_0x40d90a[_0x1384e1(0x118)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x10f91e=a109_0x38f5aa;if(!this.#binaryPath){const _0x59374a=new PercyBinary();PerformanceTester[_0x10f91e(0x109)](PerformanceEvents[_0x10f91e(0x121)]),this.#binaryPath=await _0x59374a[_0x10f91e(0xee)](this.#config),PerformanceTester[_0x10f91e(0x128)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x4b434f){return new Promise(_0x28aed6=>setTimeout(_0x28aed6,_0x4b434f));}async[a109_0x38f5aa(0x125)](){const _0x1483ef=a109_0x38f5aa,_0x1ec11f={};_0x1ec11f[_0x1483ef(0x122)]=_0x1483ef(0x11c),_0x1ec11f[_0x1483ef(0xdc)]=_0x1483ef(0x10b);const _0x304c93=_0x1ec11f;try{const _0x2a9414=await helper[_0x1483ef(0x114)](_0x304c93[_0x1483ef(0x122)],_0x304c93['ntcCG'],null,null,this.#address);if(_0x2a9414)return!![];}catch(_0x3be121){return![];}}async['start'](){const _0x5cc6b6=a109_0x38f5aa,_0x158aed={'knfob':_0x5cc6b6(0xf6),'LjnfQ':_0x5cc6b6(0x12a),'jgSAO':function(_0x5d8bb4,_0x8ce00b,_0x578919,_0x56406c){return _0x5d8bb4(_0x8ce00b,_0x578919,_0x56406c);},'VElBw':_0x5cc6b6(0x10e),'CWVkj':_0x5cc6b6(0x112)},_0x2e3ac6=await this.#getBinaryPath(),_0x1aa7b9={};_0x1aa7b9[_0x5cc6b6(0x102)]='a',this.#logStream=fs[_0x5cc6b6(0xdd)](this.#logfile,_0x1aa7b9);const _0xafee3d=await this[_0x5cc6b6(0xf3)](),_0x44d2e7=await this['createPercyConfig']();if(!_0xafee3d)return![];const _0x477430=[(this.#isApp?_0x158aed[_0x5cc6b6(0x110)]:_0x158aed['LjnfQ'])+_0x5cc6b6(0x127)];_0x44d2e7&&_0x477430[_0x5cc6b6(0xea)]('-c',_0x44d2e7);this.#proc=_0x158aed[_0x5cc6b6(0xe9)](spawn,_0x2e3ac6,_0x477430,{'env':Object[_0x5cc6b6(0x120)](process[_0x5cc6b6(0x12b)],{'PERCY_TOKEN':_0xafee3d,'TH_BUILD_UUID':process[_0x5cc6b6(0x12b)][testHubConstants[_0x5cc6b6(0x117)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x5cc6b6(0x10a)][_0x5cc6b6(0xfa)](this.#logStream),this.#proc[_0x5cc6b6(0x105)][_0x5cc6b6(0xfa)](this.#logStream),this['isProcessRunning']=!![];var _0x4ac170=this;this.#proc['on'](_0x158aed['VElBw'],function(_0x3d6b84){const _0x2600d3=_0x5cc6b6;_0x4ac170[_0x2600d3(0xec)]=![];});do{const _0x48407f=await this['healthcheck']();if(_0x48407f)return logger[_0x5cc6b6(0x103)](_0x158aed[_0x5cc6b6(0xdf)]),!![];await this.#sleep(0x3e8);}while(this[_0x5cc6b6(0xec)]);return![];}async[a109_0x38f5aa(0x11f)](){const _0x2206e3=a109_0x38f5aa,_0x11b6d1={'fRsjp':function(_0x5acd6b,_0x944e0){return _0x5acd6b(_0x944e0);},'PlmRJ':function(_0x58673d,_0x404473,_0x451e5d){return _0x58673d(_0x404473,_0x451e5d);},'SsoCu':'exec:stop','WFwDZ':_0x2206e3(0x10e)},_0xd0205d=await this.#getBinaryPath();return new Promise((_0x3c26e2,_0x53f760)=>{const _0x269300=_0x2206e3,_0x46acb1={'FhXTS':function(_0x395419,_0x470ea0){const _0x4a8dea=a109_0x19af;return _0x11b6d1[_0x4a8dea(0x113)](_0x395419,_0x470ea0);}},_0x472235=_0x11b6d1['PlmRJ'](spawn,_0xd0205d,[_0x11b6d1[_0x269300(0x124)]]);_0x472235['on'](_0x11b6d1[_0x269300(0x115)],_0x2d64fd=>{const _0x563e3b=_0x269300;this[_0x563e3b(0xec)]=![],this.#logStream&&(this.#logStream[_0x563e3b(0x128)](),this.#logStream=null),_0x46acb1[_0x563e3b(0x11e)](_0x3c26e2,_0x2d64fd);});});}[a109_0x38f5aa(0xfd)](){const _0x5f3131=a109_0x38f5aa;return this[_0x5f3131(0xec)];}async[a109_0x38f5aa(0xf3)](){const _0x26b6f1=a109_0x38f5aa,_0x5089d0={};_0x5089d0['IbfnN']=_0x26b6f1(0x118),_0x5089d0[_0x26b6f1(0x129)]=_0x26b6f1(0xf4),_0x5089d0[_0x26b6f1(0xf8)]=_0x26b6f1(0x11c),_0x5089d0[_0x26b6f1(0xe0)]=_0x26b6f1(0xe3);const _0x4b096a=_0x5089d0,_0x27b810=this.#config[_0x26b6f1(0xfe)];try{const _0x51cba0=this.#isApp?_0x4b096a[_0x26b6f1(0xe7)]:_0x4b096a[_0x26b6f1(0x129)],_0x3fd32f=await helper[_0x26b6f1(0x114)](_0x4b096a['PsEqC'],_0x26b6f1(0x123)+_0x27b810+_0x26b6f1(0xfb)+_0x51cba0,{},this.#config),_0x45aca5=_0x3fd32f['data'];return logger[_0x26b6f1(0x103)](_0x4b096a[_0x26b6f1(0xe0)]),_0x45aca5[_0x26b6f1(0x10f)];}catch(_0x1195fd){return logger['error']('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x1195fd),null;}}async[a109_0x38f5aa(0xff)](){const _0x3e201c=a109_0x38f5aa,_0x477bc6={'dNdtD':function(_0x24ed68,_0x214dff){return _0x24ed68(_0x214dff);},'UwvTA':function(_0x3de99d,_0x478a3e){return _0x3de99d+_0x478a3e;},'VTpEk':'Percy\x20config\x20created\x20at\x20','NPAlK':_0x3e201c(0x106)};if(!this.#config[_0x3e201c(0x11a)])return null;const _0x23decb=path[_0x3e201c(0xfc)](os[_0x3e201c(0x107)](),_0x477bc6[_0x3e201c(0xe4)]),_0x428792=this.#config['percyOptions'];return!_0x428792[_0x3e201c(0xf5)]&&(_0x428792[_0x3e201c(0xf5)]='2'),new Promise((_0x2d91e5,_0x4c9c67)=>{const _0x3fd738=_0x3e201c,_0xe712ba={'ZaVwR':function(_0x10e9f3,_0xcb16b){const _0x3038ac=a109_0x19af;return _0x477bc6[_0x3038ac(0x108)](_0x10e9f3,_0xcb16b);},'tnPcb':function(_0x452cad,_0x187ac8){const _0x442437=a109_0x19af;return _0x477bc6[_0x442437(0x111)](_0x452cad,_0x187ac8);},'vcbcH':_0x477bc6[_0x3fd738(0xdb)]};fs[_0x3fd738(0xeb)](_0x23decb,JSON['stringify'](_0x428792),_0x2986e5=>{const _0x3b367b=_0x3fd738;_0x2986e5&&(logger['error'](_0x3b367b(0x10c)+_0x2986e5),_0xe712ba['ZaVwR'](_0x2d91e5,null)),logger['debug'](_0xe712ba[_0x3b367b(0x11d)](_0xe712ba['vcbcH'],_0x23decb)),_0xe712ba[_0x3b367b(0x12c)](_0x2d91e5,_0x23decb);});});}}module[a109_0x38f5aa(0xf2)]=Percy;